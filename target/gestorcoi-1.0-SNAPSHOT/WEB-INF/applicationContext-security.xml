<?xml version="1.0" encoding="UTF-8"?>
<b:beans xmlns:b="http://www.springframework.org/schema/beans"
         xmlns:security="http://www.springframework.org/schema/security"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
           http://www.springframework.org/schema/security
           http://www.springframework.org/schema/security/spring-security-3.1.xsd">

    <security:global-method-security secured-annotations="enabled"/>

    <security:http auto-config="true" use-expressions="true">
        <security:access-denied-handler error-page="/error/acessoNegado.jsf"/>

        <security:intercept-url pattern="/cadastro/cad_permissao.jsf" access="hasAnyRole('SUPERVISOR')" method="POST"/>
        <security:intercept-url pattern="/resources/components/**" access="isAuthenticated() and hasAnyRole('USER')"/>
        <security:intercept-url pattern="/resources/**" access="isAuthenticated() and hasAnyRole('ADMIN')"/>
        <security:intercept-url pattern="/error/**" access="isAuthenticated() or isAnonymous() or !isAuthenticated()"/>
        <security:intercept-url pattern="/restrito/criarConta.jsf" access="isAuthenticated() and hasAnyRole('ADMIN')"/>
        <security:intercept-url pattern="/restrito/funcionarios.jsf" access="isAuthenticated() and hasAnyRole('ADMIN')"/>
        <security:intercept-url pattern="/templates/**" access="isAuthenticated() and hasAnyRole('USER')"/>
        <security:intercept-url pattern="/publico/**" access="permitAll"/>

        <security:form-login login-page="/publico/login.jsf"
                             always-use-default-target="true"
                             default-target-url="/restrito/home.jsf"
                             authentication-failure-url="/publico/login.jsf?login_error=1"
                             username-parameter="j_username"
                             password-parameter="j_password"/>
        
        <security:logout invalidate-session="true"
                         logout-success-url="/publico/login.jsf"
                         logout-url="/j_spring_security_logout"
                         delete-cookies="JSESSIONID"/>

        <security:remember-me token-validity-seconds="7200"/>

        <security:session-management invalid-session-url="/publico/login.jsf"
                                     session-fixation-protection="migrateSession">
            <security:concurrency-control max-sessions="1"
                                         expired-url="/public/login.jsf"
                                         error-if-maximum-exceeded="true"/>
        </security:session-management>
    </security:http>

    <security:authentication-manager>
        <security:authentication-provider>
            <security:password-encoder hash="plaintext"/>
            <security:jdbc-user-service data-source-ref="springDataSource"
                                       users-by-username-query="select name as username, password as password, 1 as enable from supervisor where upper(name) = upper(?)"
                                       authorities-by-username-query="select u.name as username, p.role as authority from supervisor u join roles p on u.id = p.supervisor_id where upper(u.name) = upper(?)"/>
        </security:authentication-provider>
    </security:authentication-manager>

</b:beans>